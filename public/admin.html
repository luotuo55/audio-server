<!DOCTYPE html>
<html>
<head>
    <title>音频文件管理系统</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/audio/static/css/admin.css">
    <style>
        /* 基础样式保持不变 */
    </style>
</head>
<body>
    <div class="container">
        <!-- 登录面板 -->
        <div id="loginPanel">
            <h2>管理员登录</h2>
            <div>
                <input type="password" id="adminKey" placeholder="请输入管理密钥">
                <button onclick="verifyAdmin()">登录</button>
            </div>
            <div id="loginMessage" style="margin-top: 10px; color: red;"></div>
        </div>

        <!-- 管理面板 -->
        <div id="adminPanel" style="display:none">
            <div class="header">
                <h1>音频文件管理系统 <span class="version">V1.98</span></h1>
                <button onclick="logout()" class="logout-btn">登出</button>
            </div>
            
            <!-- 导航标签 -->
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="switchTab('files')">文件管理</button>
                <button class="tab-btn" onclick="switchTab('whitelist')">白名单管理</button>
                <button class="tab-btn" onclick="switchTab('logs')">系统日志</button>
            </div>

            <!-- 内容区域 -->
            <div class="content">
                <!-- 标签页内容 -->
            </div>
        </div>
    </div>

    <script>
        // API路径配置
        const API_PATHS = {
            verify: '/audio/api/admin/verify',
            files: '/audio/api/admin/files',
            whitelist: '/audio/api/admin/whitelist',
            logs: '/audio/api/admin/logs'
        };

        // 验证管理员身份
        async function verifyAdmin() {
            const password = document.getElementById('adminKey').value.trim();
            const messageDiv = document.getElementById('loginMessage');
            
            if (!password) {
                messageDiv.textContent = '请输入管理密钥';
                return;
            }

            try {
                console.log('发送验证请求...');  // 调试日志
                const response = await fetch(API_PATHS.verify, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });

                const data = await response.json();
                console.log('验证响应:', data);  // 调试日志

                if (response.ok) {  // 只检查响应状态
                    console.log('验证成功，显示管理面板');  // 调试日志
                    // 保存token
                    localStorage.setItem('admin_token', data.token || '');
                    // 显示管理面板
                    document.getElementById('loginPanel').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    messageDiv.textContent = '';
                    // 加载初始数据
                    loadFiles();
                } else {
                    console.log('验证失败:', data.message);  // 调试日志
                    messageDiv.textContent = data.message || '验证失败';
                    document.getElementById('adminKey').value = '';
                }
            } catch (error) {
                console.error('验证请求失败:', error);  // 调试日志
                messageDiv.textContent = '验证失败，请重试';
            }
        }

        // 加载文件列表
        async function loadFiles() {
            try {
                const response = await fetch(API_PATHS.files, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                const data = await response.json();
                // 处理文件列表数据
                console.log('文件列表:', data);
            } catch (error) {
                console.error('加载文件列表失败:', error);
            }
        }

        // 登出
        function logout() {
            localStorage.removeItem('admin_token');
            document.getElementById('loginPanel').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminKey').value = '';
            document.getElementById('loginMessage').textContent = '';
        }

        // 切换标签页
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            // 这里添加标签页切换逻辑
        }

        // 添加回车键支持
        document.getElementById('adminKey').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyAdmin();
            }
        });

        // 检查是否已登录
        if (localStorage.getItem('admin_token')) {
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            loadFiles();
        }
    </script>
</body>
</html> 
